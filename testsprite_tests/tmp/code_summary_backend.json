{
  "tech_stack": [
    "PostgreSQL",
    "Supabase (Backend-as-a-Service)",
    "PostgREST (REST API)",
    "Row Level Security (RLS)",
    "Database Functions (PL/pgSQL)",
    "Supabase Auth",
    "Supabase Storage",
    "Supabase Realtime"
  ],
  "features": [
    {
      "name": "admin_enroll_student",
      "description": "RPC function for admins to enroll students into courses. Validates admin permissions, checks for duplicate enrollments, and creates enrollment record.",
      "files": [
        "supabase/migrations/015_admin_enroll_function.sql",
        "supabase/migrations/020_final_fix_enrollment.sql",
        "src/pages/admin/EnrollmentManagement.tsx"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "info": {
          "title": "Admin Enroll Student",
          "version": "1.0.0"
        },
        "paths": {
          "/rest/v1/rpc/admin_enroll_student": {
            "post": {
              "summary": "Enroll a student in a course",
              "operationId": "adminEnrollStudent",
              "requestBody": {
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "_student_id": {"type": "string", "format": "uuid"},
                        "_course_id": {"type": "string", "format": "uuid"},
                        "_admin_id": {"type": "string", "format": "uuid"}
                      },
                      "required": ["_student_id", "_course_id", "_admin_id"]
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "Enrollment result",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "success": {"type": "boolean"},
                          "enrollment_id": {"type": "string", "format": "uuid"},
                          "error": {"type": "string"}
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "admin_assign_teacher",
      "description": "RPC function for admins to assign teachers to courses. Validates admin permissions and creates teacher-course assignment.",
      "files": [
        "supabase/migrations/015_admin_enroll_function.sql",
        "supabase/migrations/020_final_fix_enrollment.sql",
        "src/pages/admin/EnrollmentManagement.tsx"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/rest/v1/rpc/admin_assign_teacher": {
            "post": {
              "summary": "Assign a teacher to a course",
              "operationId": "adminAssignTeacher",
              "requestBody": {
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "_teacher_id": {"type": "string", "format": "uuid"},
                        "_course_id": {"type": "string", "format": "uuid"},
                        "_admin_id": {"type": "string", "format": "uuid"}
                      },
                      "required": ["_teacher_id", "_course_id", "_admin_id"]
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "Assignment result",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "success": {"type": "boolean"},
                          "assignment_id": {"type": "string", "format": "uuid"},
                          "error": {"type": "string"}
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "is_profile_complete",
      "description": "RPC function to check if a user's profile is complete. For students, checks profile and guardian information. For other roles, checks basic profile.",
      "files": [
        "supabase/migrations/038_student_guardian_teacher_relationships.sql",
        "src/components/ProtectedRoute.tsx"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/rest/v1/rpc/is_profile_complete": {
            "post": {
              "summary": "Check if user profile is complete",
              "operationId": "isProfileComplete",
              "requestBody": {
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "_user_id": {"type": "string", "format": "uuid"}
                      },
                      "required": ["_user_id"]
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "Profile completion status",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "boolean"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "update_profile_completion",
      "description": "RPC function to update profile completion status. Automatically calculates and updates completion based on profile data.",
      "files": [
        "supabase/migrations/038_student_guardian_teacher_relationships.sql",
        "src/pages/ProfileCompletion.tsx"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/rest/v1/rpc/update_profile_completion": {
            "post": {
              "summary": "Update profile completion status",
              "operationId": "updateProfileCompletion",
              "requestBody": {
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "_user_id": {"type": "string", "format": "uuid"}
                      },
                      "required": ["_user_id"]
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "Update result"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "bootstrap_super_admin",
      "description": "RPC function to bootstrap super admin role for the default account (super@gmail.com). One-time setup function for development.",
      "files": [
        "supabase/migrations/021_bootstrap_super_admin.sql",
        "src/lib/auth.tsx"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/rest/v1/rpc/bootstrap_super_admin": {
            "post": {
              "summary": "Bootstrap super admin role",
              "operationId": "bootstrapSuperAdmin",
              "responses": {
                "200": {
                  "description": "Bootstrap result"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "get_next_waitlist_position",
      "description": "RPC function to get the next position in course waitlist. Used for course enrollment when capacity is full.",
      "files": [
        "supabase/migrations/011_updates.sql",
        "src/pages/CourseDetail.tsx"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/rest/v1/rpc/get_next_waitlist_position": {
            "post": {
              "summary": "Get next waitlist position for a course",
              "operationId": "getNextWaitlistPosition",
              "requestBody": {
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "p_course_id": {"type": "string", "format": "uuid"}
                      },
                      "required": ["p_course_id"]
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "Waitlist position",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "integer"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "get_course_teachers",
      "description": "RPC function to get all teachers assigned to a specific course. Returns teacher information for course detail pages.",
      "files": [
        "supabase/migrations/017_teacher_course_assignments.sql",
        "src/pages/dashboard/GuardianDashboard.tsx"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/rest/v1/rpc/get_course_teachers": {
            "post": {
              "summary": "Get teachers assigned to a course",
              "operationId": "getCourseTeachers",
              "requestBody": {
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "_course_id": {"type": "string", "format": "uuid"}
                      },
                      "required": ["_course_id"]
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "List of teachers",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "id": {"type": "string", "format": "uuid"},
                            "full_name": {"type": "string"},
                            "email": {"type": "string"},
                            "phone": {"type": "string"}
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Supabase Auth API",
      "description": "Supabase Authentication API endpoints for user registration, login, session management, and password reset.",
      "files": [
        "src/lib/auth.tsx",
        "src/pages/Auth.tsx"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/auth/v1/signup": {
            "post": {
              "summary": "Register a new user",
              "operationId": "signup",
              "requestBody": {
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "email": {"type": "string"},
                        "password": {"type": "string"},
                        "data": {"type": "object"}
                      },
                      "required": ["email", "password"]
                    }
                  }
                }
              }
            }
          },
          "/auth/v1/token": {
            "post": {
              "summary": "Login user",
              "operationId": "login",
              "requestBody": {
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "grant_type": {"type": "string", "default": "password"},
                        "email": {"type": "string"},
                        "password": {"type": "string"}
                      },
                      "required": ["email", "password"]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Supabase REST API - Courses",
      "description": "REST API endpoints for course CRUD operations via Supabase PostgREST.",
      "files": [
        "src/pages/Courses.tsx",
        "src/pages/admin/CreateCourse.tsx",
        "src/pages/admin/EditCourse.tsx"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/rest/v1/courses": {
            "get": {
              "summary": "List all courses",
              "operationId": "listCourses"
            },
            "post": {
              "summary": "Create a new course",
              "operationId": "createCourse"
            }
          },
          "/rest/v1/courses/{id}": {
            "get": {
              "summary": "Get course by ID",
              "operationId": "getCourse"
            },
            "patch": {
              "summary": "Update course",
              "operationId": "updateCourse"
            },
            "delete": {
              "summary": "Delete course",
              "operationId": "deleteCourse"
            }
          }
        }
      }
    },
    {
      "name": "Supabase REST API - Enrollments",
      "description": "REST API endpoints for course enrollment operations.",
      "files": [
        "src/pages/admin/EnrollmentManagement.tsx",
        "src/pages/dashboard/StudentDashboard.tsx"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/rest/v1/course_enrollments": {
            "get": {
              "summary": "List enrollments",
              "operationId": "listEnrollments"
            },
            "post": {
              "summary": "Create enrollment",
              "operationId": "createEnrollment"
            }
          }
        }
      }
    },
    {
      "name": "Supabase REST API - Library",
      "description": "REST API endpoints for library content (books and videos) operations.",
      "files": [
        "src/pages/Library.tsx",
        "src/pages/library/UploadContent.tsx"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/rest/v1/books": {
            "get": {
              "summary": "List books",
              "operationId": "listBooks"
            },
            "post": {
              "summary": "Create book",
              "operationId": "createBook"
            }
          },
          "/rest/v1/videos": {
            "get": {
              "summary": "List videos",
              "operationId": "listVideos"
            },
            "post": {
              "summary": "Create video",
              "operationId": "createVideo"
            }
          }
        }
      }
    },
    {
      "name": "Supabase Storage API",
      "description": "Supabase Storage API for file uploads, downloads, and management of course materials and library content.",
      "files": [
        "src/pages/library/UploadContent.tsx",
        "src/pages/admin/CourseMaterials.tsx"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/storage/v1/object/{bucket}/{path}": {
            "post": {
              "summary": "Upload file",
              "operationId": "uploadFile"
            },
            "get": {
              "summary": "Download file",
              "operationId": "downloadFile"
            },
            "delete": {
              "summary": "Delete file",
              "operationId": "deleteFile"
            }
          }
        }
      }
    },
    {
      "name": "Row Level Security (RLS) Policies",
      "description": "Database-level security policies that enforce access control based on user roles and permissions.",
      "files": [
        "supabase/migrations/016_fix_enrollment_rls.sql",
        "supabase/migrations/020_final_fix_enrollment.sql",
        "supabase/migrations/024_enforce_strict_rbac.sql"
      ],
      "api_doc": {
        "description": "RLS policies are enforced at the database level and automatically applied to all REST API requests. Policies check user roles, permissions, and relationships to determine access."
      }
    }
  ]
}

